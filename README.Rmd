---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = FALSE,
  comment = "  ",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

suppressPackageStartupMessages({
  library(dplyr)
  library(ggplot2)
  library(tidyr)
  
  library(minisvg)
  library(svgpatternsimple)
})

set.seed(1) # for repeatable stipple pattern
```


```{r echo = FALSE, eval = FALSE}
# Quick logo generation. Borrowed heavily from Nick Tierney's Syn logo process
library(magick)
library(showtext)
font_add_google("Abril Fatface", "gf")


# pkgdown::build_site(override = list(destination = "../coolbutuseless.github.io/package/svgpatternsimple"))
```


```{r echo = FALSE, eval = FALSE}
img <- image_read("man/figures/white.png") 


hexSticker::sticker(subplot  = img,
                    s_x      = 0.92,
                    s_y      = 1.2,
                    s_width  = 1.5,
                    s_height = 0.95,
                    package  = "svg\npattern\nsimple",
                    p_x      = 1,
                    p_y      = 1.1,
                    p_color  = "#223344",
                    p_family = "gf",
                    p_size   = 9,
                    h_size   = 1.2,
                    h_fill   = "#ffffff",
                    h_color  = "#223344",
                    filename = "man/figures/logo.png")

image_read("man/figures/logo.png")
```


# svgpatternsimple   <img src="man/figures/logo.png" align="right" height=230/>

<!-- badges: start -->
![](http://img.shields.io/badge/cool-useless-green.svg)
![](http://img.shields.io/badge/mini-verse-blue.svg)
<!-- badges: end -->

`svgpatternsimple` provides a basic set of simple repeating SVG patterns.


## Installation

You can install from [GitHub](https://github.com/coolbutuseless/svgpatternsimple) with:

``` r
# install.packages("devtools")
install_github("coolbutuseless/lofi")             # for encoding information as RGB colours
install_github("coolbutuseless/poissoned")        # Generate points via poisson disk sampling
install_github("coolbutuseless/minnisvg")         # Build SVG documents with R
install_github("coolbutuseless/svgpatternsimple") # This package
```


## Example: What is a pattern?

The patterns generated by this package are SVG `<pattern>` elements created
with [`minisvg`](https://github.com/coolbutuseless/minisvg).

`minisvg` elements are R6 objects which render to a string representing SVG.

To wrap the pattern in a generic SVG document use the
method `$as_full_svg()`, and to display it in an RStudio session use `$show()`

```{r fig.width=4}
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Create a dot pattern
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
dot <- create_dot_pattern(id = 'dot')
```

```{r eval=FALSE}
dot$show()
```


```{r echo=FALSE, results='asis'}
cat("<pre><details closed><summary> Show SVG text (click to open) </summary>",
htmltools::htmlEscape(as.character(dot$as_full_svg())), 
"</details></pre>\n", sep='')
```


```{r echo = FALSE}
if (interactive()) {
  dot$show()
} 
dot$save_full_svg("man/figures/README-example-dot.svg", height=100, include_declaration = FALSE)
```

<img src="man/figures/README-example-dot.svg" />




## Example: All patterns

There are 8 pattern types included in this package - this includes a `null`
pattern which doesn't do anything.

Patterns are created using `create_[type]_pattern()`, and arguments control the
appearance of the generated pattern e.g. opacity, orientation etc.

```{r}
dot          <- create_dot_pattern     (id = 'p1' , fill_fraction = 0.4)
stripe       <- create_stripe_pattern  (id = 'p2' , angle = 60)
hatch        <- create_hatch_pattern   (id = 'p3' , spacing = 50)
stipple      <- create_stipple_pattern (id = 'p4' , colour = 'hotpink')
hex          <- create_hex_pattern     (id = 'p5' , fill_fraction = 0.1)
check        <- create_check_pattern   (id = 'p6' , spacing = 30, colour = 'darkgreen')
gradient     <- create_gradient_pattern(id = 'p7' , colour1 = 'hotpink', colour2 = 'darkblue')
null         <- create_null_pattern    (id = 'p8' , colour = '#123456')
```


```{r echo=FALSE}
pattern_list <- list(dot, stripe, hatch, stipple, hex, check, gradient, null)
doc <- SVGPatternList_to_svg(pattern_list, height = 100, ncol = 2)
```


```{r echo=FALSE, results='asis'}
cat("<pre><details closed><summary> Show SVG text (click to open) </summary>",
htmltools::htmlEscape(as.character(doc)), 
"</details></pre>\n", sep='')
```


```{r echo = FALSE}
if (interactive()) {
  doc$show()
  doc$save("man/figures/README-all-patterns.svg")
} 
```

<img src="man/figures/README-all-patterns.svg" />



### Stripes

```{r echo=FALSE}
vars <- expand.grid(
  angle = c(0, 45, 90, 135),
  fill_fraction = c(0.05, 0.25, 0.5, 0.95)
) %>% 
  mutate(id = paste('stripe', angle, fill_fraction, sep="_"))

patterns <- vars %>% 
  purrr::pmap(create_stripe_pattern)
```


```{r echo=FALSE}
doc <- SVGPatternList_to_svg(patterns, width = 200, height = 100, ncol = 4)
```


```{r echo=FALSE, results='asis'}
cat("<pre><details closed><summary> Show SVG text (click to open) </summary>",
htmltools::htmlEscape(as.character(doc)), 
"</details></pre>\n", sep='')
```

```{r echo = FALSE}
if (interactive()) {
  doc$show()
} 
doc$save("man/figures/README-stripes.svg")
```

<img src="man/figures/README-stripes.svg" />



### Dot patterns

```{r echo=FALSE}
vars <- expand.grid(
  angle = c(0, 22.5, 45, 67.5),
  fill_fraction = c(0.05, 0.25, 0.5, 0.95)
) %>% 
  mutate(id = paste('dot', angle, fill_fraction, sep="_"))

patterns <- vars %>% 
  purrr::pmap(create_dot_pattern) 
```

```{r echo=FALSE}
doc <- SVGPatternList_to_svg(patterns, width = 200, height = 100, ncol = 4)
```


```{r echo=FALSE, results='asis'}
cat("<pre><details closed><summary> Show SVG text (click to open) </summary>",
htmltools::htmlEscape(as.character(doc)), 
"</details></pre>\n", sep='')
```

```{r echo = FALSE}
if (interactive()) {
  doc$show()
} 
doc$save("man/figures/README-dots.svg")
```

<img src="man/figures/README-dots.svg" />

### Hatching

```{r echo=FALSE}
patterns <- vars %>% 
  mutate(id = paste('hatch', angle, fill_fraction, sep="_")) %>% 
  purrr::pmap(create_hatch_pattern) 
```


```{r echo=FALSE}
doc <- SVGPatternList_to_svg(patterns, width = 200, height = 100, ncol = 4)
```


```{r echo=FALSE, results='asis'}
cat("<pre><details closed><summary> Show SVG text (click to open) </summary>",
htmltools::htmlEscape(as.character(doc)), 
"</details></pre>\n", sep='')
```

```{r echo = FALSE}
if (interactive()) {
  doc$show()
} 
doc$save("man/figures/README-hatch.svg")
```

<img src="man/figures/README-hatch.svg" />

### Stippling

```{r echo=FALSE}
set.seed(1)
patterns <- vars %>% 
  mutate(id = paste('stipple', angle, fill_fraction, sep="_")) %>% 
  purrr::pmap(create_stipple_pattern) 
```


```{r echo=FALSE}
doc <- SVGPatternList_to_svg(patterns, width = 200, height = 100, ncol = 4)
```


```{r echo=FALSE, results='asis'}
cat("<pre><details closed><summary> Show SVG text (click to open) </summary>",
htmltools::htmlEscape(as.character(doc)), 
"</details></pre>\n", sep='')
```

```{r echo = FALSE}
if (interactive()) {
  doc$show()
} 
doc$save("man/figures/README-stipple.svg")
```

<img src="man/figures/README-stipple.svg" />

### Hex patterns

```{r echo=FALSE}
patterns <- vars %>% 
  mutate(id = paste('hex', angle, fill_fraction, sep="_")) %>% 
  purrr::pmap(create_hex_pattern)
```


```{r echo=FALSE}
doc <- SVGPatternList_to_svg(patterns, width = 200, height = 100, ncol = 4)
```


```{r echo=FALSE, results='asis'}
cat("<pre><details closed><summary> Show SVG text (click to open) </summary>",
htmltools::htmlEscape(as.character(doc)), 
"</details></pre>\n", sep='')
```

```{r echo = FALSE}
if (interactive()) {
  doc$show()
} 
doc$save("man/figures/README-hex.svg")
```

<img src="man/figures/README-hex.svg" />

### Check patterns

```{r echo=FALSE}
vars <- expand.grid(
  angle = c(0, 22.5, 45, 67.5),
  spacing = c(0.1, 0.25, 0.5, 0.95) * 100
) %>% 
  mutate(id = paste('check', angle, spacing, sep="_"))

patterns <- vars %>% 
  purrr::pmap(create_check_pattern) 
```


```{r echo=FALSE}
doc <- SVGPatternList_to_svg(patterns, width = 200, height = 100, ncol = 4)
```


```{r echo=FALSE, results='asis'}
cat("<pre><details closed><summary> Show SVG text (click to open) </summary>",
htmltools::htmlEscape(as.character(doc)), 
"</details></pre>\n", sep='')
```

```{r echo = FALSE}
if (interactive()) {
  doc$show()
} 
doc$save("man/figures/README-check.svg")
```

<img src="man/figures/README-check.svg" />


### Gradients

```{r echo=FALSE}

vars <- expand.grid(
  angle = c(0, 45),
  colour1 = c('#ffffff', '#000000'),
  colour2 = c('#aa7733', '#224466', '#77aa33', '#ffbb99')
) %>% 
  mutate(id = paste('grad', angle, colour1, colour2, sep="_"))

patterns <- vars %>% 
  purrr::pmap(create_gradient_pattern) 
```


```{r echo=FALSE}
doc <- SVGPatternList_to_svg(patterns, width = 200, height = 100, ncol = 4)
```


```{r echo=FALSE, results='asis'}
cat("<pre><details closed><summary> Show SVG text (click to open) </summary>",
htmltools::htmlEscape(as.character(doc)), 
"</details></pre>\n", sep='')
```

```{r echo = FALSE}
if (interactive()) {
  doc$show()
} 
doc$save("man/figures/README-gradients.svg")
```

<img src="man/figures/README-gradients.svg" />


## Encoding/decoding patterns from colours

A key feature of this set of patterns is that they can be encoded in
an RGB colour.  Also, every RGB colour (excluding black, white and fully transparent)
can be decoded to a pattern in this library.

This encoding/decoding is carried out by the [`lofi`](https://github.com/coolbutuseless/lofi) package.
Because this has to squeeze multiple continuous variables in to 24-bits, along with 
the actual colour of the pattern, there
will be some quantization associated with a pattern-encoded-as-RGB e.g. angle may
only be encoded in 45degree increments.

```{r}
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Encode a stripe pattern into a colour. Arguments to set correspond to 
# arguments from the individual pattern creation function 
# e.g. `create_stripe_pattern()`
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
hex_colour <- encode_pattern_params_as_hex_colour(
  pattern_name = 'stripe', 
  angle = 135,
  fill_fraction = 0.8,
  colour = 'darkblue'
)

hex_colour

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Decode this hex colour back into a pattern object
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
pattern <- decode_pattern_from_rgba_vec(lofi::hex_colour_to_rgba_vec(hex_colour))

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Render the pattern object
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
doc <- pattern$as_full_svg(width = 400, height = 100)
```


```{r echo=FALSE, results='asis'}
cat("<pre><details closed><summary> Show SVG text (click to open) </summary>",
htmltools::htmlEscape(as.character(doc)), 
"</details></pre>\n", sep='')
```

```{r echo = FALSE}
if (interactive()) {
  doc$show()
} 
doc$save("man/figures/README-encode-as-colour.svg")
```

<img src="man/figures/README-encode-as-colour.svg" />


### Mapping from RGB Space into Pattern Space

Colours in *RGB space* do not really map to anything 
coherent in *pattern space*.

The following shows a viridis palette mapped to patterns.  Note that patterns 
near each other are possibly of similar type e.g. the last 4 patterns
are all checkerboard.


```{r viridis_img, echo=FALSE, fig.height = 2}
img <- function(obj, nam) {
  image(1:length(obj), 1, as.matrix(1:length(obj)), col=obj, 
        main = nam, ylab = "", xaxt = "n", yaxt = "n",  bty = "n", xlab = '')
}

img(viridis::cividis(32), "viridis::cividis(32)")
```

 

```{r}
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Create the patterns corresponding to 32 cividis colours
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
patterns <- viridis::cividis(32) %>%
  lapply(lofi::hex_colour_to_rgba_vec) %>%
  lapply(decode_pattern_from_rgba_vec)
```


```{r echo=FALSE}
doc <- SVGPatternList_to_svg(patterns, width = 200, height = 100, ncol = 4)
```



```{r echo=FALSE, results='asis'}
cat("<pre><details closed><summary> Show SVG text (click to open) </summary>",
htmltools::htmlEscape(as.character(doc)), 
"</details></pre>\n", sep='')
```


```{r echo = FALSE}
if (interactive()) {
  doc$show()
} 
doc$save("man/figures/README-viridis.svg")
```

<img src="man/figures/README-viridis.svg" />
















